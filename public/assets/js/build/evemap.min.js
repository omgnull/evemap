var EveMap=function(a){this.scheme=1,this.settings=a,this.camera=void 0,this.controls=void 0,this.loader=void 0,this.raycaster=void 0,this.colors=void 0,this.log=void 0,this.index={},this.raw={},this.regions=[],this.regionalJumps={},this.wgl=void 0,this.gui=void 0,this.events=[EveMap.EVENT_MAP_LOADING,EveMap.EVENT_MAP_DATA_LOADED,EveMap.EVENT_MAP_LOAD_COMPLETE,EveMap.EVENT_MAP_RENDERED],this._heap={},this._state=void 0};EveMap.prototype={constructor:EveMap,addEvent:function(a,b){if(-1===this.events.indexOf(a))throw new Error('Event number "'+a+'" not defined.');this._heap[a]||(this._heap[a]=[]),this._heap[a].push(b)},dispatch:function(a){if(-1===this.events.indexOf(a))throw new Error('Event number "'+a+'" not defined.');if(this._state>=a&&-1!==a)throw new Error('Event "'+a+'" stage already complete.');this.gui.progress(a);var b=this._heap[a];if(b){for(var c=0;c<b.length;c++)b[c]();this._state=a}},render:function(){try{this.loader=new EveMap.Loader(this),this.loader.init(),this.addEvent(EveMap.EVENT_MAP_LOADING,function(){this.loader.delayed(function(){if(!this.settings.materials.loaded)return!1;for(var a=0;a<this.settings.sources.length;a++)if(!this.raw[this.settings.sources[a]])return!1;return!0}.bind(this),function(){this.colors.default=new THREE.Color(this.settings.colorSettings.default),this.colors.unAccessible=new THREE.Color(this.settings.colorSettings.unAccessible);for(var a=this.settings.colorSettings.generate,b=0;b<a.length;b++)this.raw[a[b]]&&this.colors.generateColors(a[b],this.raw[a[b]].length,this.colors.randomize);this.dispatch(EveMap.EVENT_MAP_DATA_LOADED)}.bind(this),1e3)}.bind(this)),this.addEvent(EveMap.EVENT_MAP_DATA_LOADED,function(){this.loader.delayed(function(){return this.wgl.loaded}.bind(this),function(){this.dispatch(EveMap.EVENT_MAP_LOAD_COMPLETE)}.bind(this),500)}.bind(this)),this.addEvent(EveMap.EVENT_MAP_LOAD_COMPLETE,function(){this.loader.delayed(function(){return this.gui.loaded}.bind(this),function(){this.dispatch(EveMap.EVENT_MAP_RENDERED)}.bind(this),500)}.bind(this)),this.dispatch(EveMap.EVENT_MAP_LOADING)}catch(a){this.log(a)}},_highlightSystem:function(a,b){var c,d;if(c=new THREE.Vector3(2*a-1,2*-b+1,.5),this.settings.projector.unprojectVector(c,this.settings.camera),this.raycaster.set(this.settings.camera.position,c.sub(this.settings.camera.position).normalize()),d=this.raycaster.intersectSystems(this.regions),d.length>0)for(var e=0;e<d.length;e++)console.log(d[e].object.region.name+" "+d[e].object.name);else console.log("none")}},EveMap.SCALE=1,EveMap.RAY_THRESHOLD=.1,EveMap.EVENT_MAP_LOADING=5,EveMap.EVENT_MAP_DATA_LOADED=45,EveMap.EVENT_MAP_LOAD_COMPLETE=90,EveMap.EVENT_MAP_RENDERED=100,EveMap.Audio=function(a){a=a||{},this.appId=a.appId,this.autoPlay=void 0!==a.autoPlay?a.autoPlay:!0,this.sortOrder=void 0!==a.sortOrder?a.sortOrder:"desc",this.sortProperty=void 0!==a.sortProperty?a.sortProperty:"favoritings_count",this.volume=void 0!==a.volume?a.volume:.5,this.currentTime=0,this.domElement=document.createElement("div"),this.domElement.id="audio-player",this.player=void 0,this.playerTitle=void 0,this._tracks=[],this._num=0;var b=a.domElement?a.domElement:document;b.appendChild(this.domElement),this.error=0,this._init(a.url)},EveMap.Audio.prototype={constructor:EveMap.Audio,_init:function(a){var b=document.createElement("script");b.onload=function(){SC.initialize({client_id:this.appId}),this._resolveUrl(a)}.bind(this),b.src="http://connect.soundcloud.com/sdk.js",document.getElementsByTagName("head")[0].appendChild(b)},_play:function(a){this.player.src=this._uri(this._num),this.playerTitle.textContent=this._title(this._num),a&&this.player.play()},_resolveUrl:function(a){SC.get("/resolve",{url:a},function(a,b){if(null!==b)throw console.log(b),new TypeError;this._loadTracks(a.uri)}.bind(this))},_loadTracks:function(a){-1===a.indexOf("/tracks")&&(a+="/tracks"),SC.get(a,{limit:100},function(a,b){if(null!==b)throw console.log(b),new TypeError;if(0==a.length)throw new TypeError("No tracks loaded.");var c=this.sortProperty,d=this.sortOrder;a.sort(this.sortOrder&&this.sortProperty?function(a,b){return"desc"===d?a[c]>b[c]?-1:a[c]<b[c]?1:0:a[c]<b[c]?-1:a[c]>b[c]?1:0}:function(){return Math.round(Math.random())}),this._tracks=a,this._render()}.bind(this))},_changeTrack:function(a,b){this._tracks[a]||(a=b),this._num=a,this.play()},_render:function(){this.playerTitle=document.createElement("div"),this.player=new Audio,this.player.setAttribute("controls","controls"),this.player.setAttribute("preload","auto"),this.player.volume=this.volume,this.player.autoplay=this.autoPlay,this.domElement.appendChild(this.playerTitle),this.domElement.appendChild(this.player),this.player.addEventListener("ended",function(){this.next()}.bind(this)),this.player.addEventListener("timeupdate",function(){0==this.error&&(this.currentTime=this.player.currentTime,this.error=0)}.bind(this)),this._play(this.autoPlay)},_title:function(a){return this._tracks[a].title},_uri:function(a){return this._tracks[a].stream_url+"?client_id="+this.appId},next:function(){this._changeTrack(this._num+1,0)},prev:function(){this._changeTrack(this._num-1,this._tracks.length-1)},play:function(){this._play(!0)}},EveMap.Colors=function(){this._generic={},this.default=void 0,this.randomize=!0,this.unAccessible=void 0,this.system={security:[],actual:[]}},EveMap.Colors.prototype={constructor:EveMap.Colors,getGenericColor:function(a,b){return this._generic[a][b]?this._generic[a][b]:this.default},getGenericColors:function(a,b){return!this._generic[a]&&b>0&&this.generateColors(a,b,this.randomize),this._generic[a]?this._generic[a]:[]},getSystemSecurityColor:function(a){return 0>a?this.system.security[10]:.15>a?this.system.security[9]:.25>a?this.system.security[8]:.35>a?this.system.security[7]:.45>a?this.system.security[6]:.55>a?this.system.security[5]:.65>a?this.system.security[4]:.75>a?this.system.security[3]:.85>a?this.system.security[2]:.95>a?this.system.security[1]:this.system.security[0]},getSystemActualColor:function(a){return this.system.actual[a]||this.default},generateColors:function(a,b,c){for(var d,e=[],f=0;b>f;f++)d=this.default.clone(),d.setHSL(f/b,.8,.5),e.push(d);c&&e.sort(function(){return Math.round(Math.random())}),this._generic[a]=e}},EveMap.GUI=function(a,b){this.evemap=a,this.loaded=!1,this.scene=new THREE.Scene,this.renderer=new THREE.CSS3DRenderer,this.renderer.domElement.id="gui-renderer",this.gui=document.createElement("div"),this.gui.id="gui",this.tools=void 0,this.names=[],this.progressBar=document.getElementById("progress-bar"),b.appendChild(this.renderer.domElement),b.appendChild(this.gui),this.evemap.addEvent(EveMap.EVENT_MAP_LOADING,this.load.bind(this))},EveMap.GUI.prototype={constructor:EveMap.GUI,add:function(a){this.scene.add(a)},addTool:function(a){var b=document.createElement("li");b.id=a.name.replace("/s/g","-"),b.textContent=a.name;var c=document.createElement("span");c.setAttribute("class","tool-label");var d="tool";if(a.position&&(d+=" "+a.position),b.setAttribute("class",d),a.parent){var e=this.tools.getElementById(a.parent.replace(" ","-"));if(e){var f=e.childNodes[1];f||(f=document.createElement("ul"),f.setAttribute("class","tool-list"),e.appendChild(f));var g=document.createElement("li");g.appendChild(b),f.appendChild(g)}}else this.tools.appendChild(b)},load:function(){document.getElementById("viewport");this.tools=document.getElementById("tools"),this.gui.style.top=this.evemap.settings.toolbarHeight,this.evemap.addEvent(EveMap.EVENT_MAP_LOAD_COMPLETE,function(){var a=this.progressBar,b=jQuery(a).find(".progress-bar-content");b.promise().done(function(){var c=document.getElementById("loading-screen");b.text("start"),a.setAttribute("class","complete");var d=a.addEventListener("click",function(b){b.preventDefault(),a.removeEventListener("click",d),jQuery(c).animate({opacity:0},function(){var a=document.getElementById("about").innerHTML;this.addTool({name:"about",position:"right",content:a}),c.parentNode.removeChild(c),this.evemap.controls.enabled=!0,this.evemap.controls.autoRotate=!0}.bind(this))}.bind(this))}.bind(this));new EveMap.Audio({url:"http://soundcloud.com/ccpgames/sets/eve-online-in-game-tracks",appId:"f1e92862a3ba94720b75c32749f505a5",domElement:this.gui,autoPlay:!0});$(this.gui).append('<div id="test-click">Click me</div>'),document.getElementById("test-click").addEventListener("click",function(){this.evemap.scheme++,this.evemap.scheme>3&&(this.evemap.scheme=1);var a,b;for(a=0;a<this.evemap.regions.length;a++)b=this.evemap.regions[a],b.systems.material.uniforms.scheme.value=this.evemap.scheme,b.jumps.material.uniforms.scheme.value=this.evemap.scheme;this.evemap.regionalJumps.material.uniforms.scheme.value=this.evemap.scheme}.bind(this),!1),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",this.loaded=!0}.bind(this))},progress:function(a){var b=jQuery(this.progressBar),c=b.width()/100*a;jQuery(b.children()[0]).animate({width:c+"px"})},render:function(){this.renderer.render(this.scene,this.evemap.camera)},resize:function(a,b){this.renderer.setSize(a,b),this.gui.style.height=b+"px",this.gui.style.width=a+"px"}},EveMap.GUI.Window=function(a,b,c,d,e){this.title=a,this.content=b,this.domElement=void 0,this.headerDomElement=void 0,this.contentDomElement=void 0,this.domParent=e,this.height=c,this.width=d,this.activated=!1,this._events={_onMouseUp:void 0,_onMouseMove:void 0},this._init()},EveMap.GUI.Window.prototype={constructor:EveMap.GUI.Window,_init:function(){this.domElement=document.createElement("div"),this.domElement.setAttribute("class","gui-window"),this.domElement.style.display="none",this.domElement.style.height=this.height+"px",this.domElement.style.width=this.width+"px",this.domParent.appendChild(this.domElement),this.headerDomElement=document.createElement("div"),this.headerDomElement.setAttribute("class","gui-window-header"),this.headerDomElement.textContent=this.title,this.headerDomElement.addEventListener("mousedown",this._onMouseDown.bind(this));var a=document.createElement("div");a.setAttribute("class","gui-window-close"),a.textContent="x",a.addEventListener("click",this.close.bind(this)),this.contentDomElement=document.createElement("div"),this.contentDomElement.setAttribute("class","gui-window-content")},_onMouseUp:function(){this.domParent.removeEventListener("mousemove",this._events._onMouseMove),this.domParent.removeEventListener("mouseup",this._events._onMouseUp)},_onMouseDown:function(a){a.target===this.headerDomElement&&(this._events._onMouseMove=this.domParent.addEventListener("mousemove",this._onMouseMove.bind(this)),this._events._onMouseUp=this.domParent.addEventListener("mouseup",this._onMouseMove.bind(this)))},_onMouseMove:function(){},close:function(){this.domElement.style.display="none"},open:function(){this.activated||("function"==typeof this.content?this.content(this):this.contentDomElement.textContent=this.content,this.activated=!0),this.domElement.style.display="block"},update:function(){}},EveMap.Helper=function(){},EveMap.Helper.prototype={constructor:EveMap.Helper},EveMap.Label={_createTexture:function(a,b){var c,d,e;return c=document.createElement("canvas"),d=c.getContext("2d"),d.font=b.font,d.textAlign="center",d.fillStyle=b.fillStyle,b.uppercase&&(a=a.toUpperCase()),d.fillText(a,c.width/2,c.height/2),e=new THREE.Texture(c),e.needsUpdate=!0,e.attr={width:c.width,height:c.height},e},createSpriteLabel:function(a,b){var c,d;return d=new THREE.SpriteMaterial({map:this._createTexture(a.name,b),blending:THREE.NormalBlending,alignment:new THREE.Vector2(0,0),transparent:!0,useScreenCoordinates:!0}),c=new THREE.Sprite(d),c.scale.set(b.scaleHeight*EveMap.SCALE,b.scaleWidth*EveMap.SCALE,1),c},createPlaneLabel:function(a,b,c){var d,e;return e=this._createTexture(a.name,c),b.uniforms.map0.value=e,b.uniforms.map0.needsUpdate=!0,d=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1),b),d.position.copy(a.position?a.position:a),d.scale.set(c.scaleHeight*EveMap.SCALE,c.scaleWidth*EveMap.SCALE,1),d},createCSS3DLabel:function(a,b){var c,d,e;return e=document.createElement("div"),e.className=b.className?"l "+b.className:"l",d=document.createElement("div"),d.className="name",d.textContent=a.name,e.appendChild(d),c=new THREE.CSS3DObject(e),c.position.copy(a.position?a.position:a),c}},EveMap.Loader=function(a){this.evemap=a,this.errors=0,this.viewport=document.getElementById("viewport"),this.minHeight=this.evemap.settings.scene.minHeight,this.minWidth=this.evemap.settings.scene.minWidth,this.toolbarHeight=this.evemap.settings.toolbarHeight},EveMap.Loader.prototype={constructor:EveMap.Loader,init:function(){window.onerror=function(a,b,c){return this.evemap.log(new TypeError("Error: "+a+"\nurl: "+b+"\nline #: "+c)),!0}.bind(this),this.evemap.camera=this.evemap.settings.camera(),this.evemap.raycaster=this.evemap.settings.raycaster,this.evemap.colors=this.evemap.settings.colors,this.evemap.log=this.evemap.settings.logger.log,this.evemap.settings.materials.compile(this.evemap),this.evemap.wgl=new EveMap.WGL(this.evemap,this.viewport),this.evemap.gui=new EveMap.GUI(this.evemap,this.viewport),this.evemap.controls=this.evemap.settings.controls(this.evemap.camera,this.evemap.gui.gui),this.evemap.addEvent(EveMap.EVENT_MAP_LOADING,this.loadMapData.bind(this)),window.addEventListener("resize",this._resizeScene.bind(this)),this._resizeScene(),this._animate()},_animate:function(){this.evemap.controls.update(),this.evemap.wgl.render(),this.evemap.gui.render(),requestAnimationFrame(this._animate.bind(this))},_resizeScene:function(){var a,b;a=this.viewport.clientWidth<this.minWidth?this.minWidth:this.viewport.clientWidth,b=this.viewport.clientHeight<this.minHeight?this.minHeight:this.viewport.clientHeight,b-=this.toolbarHeight,this.evemap.camera.aspect=a/b,this.evemap.camera.updateProjectionMatrix(),this.evemap.wgl.resize(a,b),this.evemap.gui.resize(a,b)},delayed:function(a,b,c){if(!a()){if(this.errors>0)throw new Error("Stop delayed execution, we got network errors.");return void window.setTimeout(this.delayed.bind(this,a,b,c),c)}b()},loadData:function(a,b,c){c=c||{};var d=this,e={async:!0,type:c.data?"POST":"GET",cache:!0,beforeSend:null,data:null,dataType:"json",context:this.context};$.extend(e,c),$.ajax(a,e).done(b).fail(function(a,b,c){d.evemap.log(c),d.errors++})},loadMapData:function(){if(this.evemap.settings.dump)return void this.loadData(this.evemap.settings.uri.dump,function(a){return function(b){a.raw=b;for(var c in a.raw)a.raw.hasOwnProperty(c)&&(a.index[c]={})}}(this.evemap));var a,b;for(a=0;a<this.evemap.settings.sources.length;a++)b=this.evemap.settings.sources[a],this.loadData(this.evemap.settings.uri[b],function(a,b){return function(c){a.raw[b]=c,a.index[b]=[]}}(this.evemap,b))}},window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),EveMap.Logger=function(){THREE.Object3D.call(this),this.GUI=null},EveMap.Logger.prototype={constructor:EveMap.Logger,log:function(){var a;if(console&&console.log)for(var b=0;b<arguments.length;b++)if(a=arguments[b],void 0!==a)a.message&&(console.log(a.message),a.stack&&console.log(a.stack)),console.log(a);else{var c=new Error("Log undefined variable.");this.log(c)}},GUILog:function(a){this.GUI.log(a)}},EveMap.Materials=function(){this.loaded=!1},EveMap.Materials.prototype={constructor:EveMap.Materials,_materials:{stars:{main:function(a){return{uniforms:{color:{type:"c",value:new THREE.Color(16777215)},scheme:{type:"f",value:1},scale:{type:"f",value:EveMap.SCALE},map0:{type:"t",value:THREE.ImageUtils.loadTexture("assets/img/disc.png")},map1:{type:"t",value:THREE.ImageUtils.loadTexture("assets/img/flare.png")}},vertexShader:a.shaders.loaded.stars.vertex,fragmentShader:a.shaders.loaded.stars.fragment,depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.AdditiveBlending,blendSrc:THREE.SrcAlphaFactor,blendEquation:THREE.AddEquation}},attributes:function(){return{actualColor:{type:"c",value:[]},regionColor:{type:"c",value:[]},securityColor:{type:"c",value:[]},radius:{type:"f",value:[]}}}},lines:{main:function(a){return{uniforms:{color:{type:"c",value:new THREE.Color(13882323)},scheme:{type:"f",value:1},alpha:{type:"f",value:.12}},vertexShader:a.shaders.loaded.lines.vertex,fragmentShader:a.shaders.loaded.lines.fragment,blending:THREE.SrcAlphaFactor,depthTest:!0,depthWrite:!1,transparent:!0}},attributes:function(){return{actualColor:{type:"c",value:[]},regionColor:{type:"c",value:[]},securityColor:{type:"c",value:[]}}}},labels:{main:function(a){return{vertexShader:a.shaders.loaded.labels.vertex,fragmentShader:a.shaders.loaded.labels.fragment,depthTest:!1,depthWrite:!1,transparent:!0,blending:THREE.AdditiveBlending,blendSrc:THREE.SrcAlphaFactor,blendEquation:THREE.AddEquation}},uniforms:function(){return{color:{type:"c",value:new THREE.Color(16777215)},map0:{type:"t",value:""}}}}},shaders:{},compile:function(a){var b=a.loader,c=a.settings.uri.shaders;this.shaders=a.settings.shaders;for(var d,e,f=0,g={dataType:"text",async:!0},h=0;h<this.shaders.list.length;h++){e=this.shaders.list[h],this.shaders.loaded[e]={};for(var i=0;i<this.shaders.extensions.length;i++)d=this.shaders.extensions[i].split("|"),b.loadData(c+e+d[1],function(a,b,c){return function(d){a.shaders.loaded[b][c]=d,f++}}(this,e,d[0]),g)}b.delayed(function(){return 2*this.shaders.list.length===f}.bind(this),function(){var a,b;for(a=0;a<this.shaders.list.length;a++)b=this.shaders.list[a],this._materials[b].main=new this._materials[b].main(this);this.loaded=!0}.bind(this),1e3)},getMaterial:function(a){var b,c,d,e,f=["uniforms","attributes"];if(!this._materials[a])throw new Error('Material "%s" not exists'.replace("%s",a));for(c=new THREE.ShaderMaterial(this._materials[a].main),b=0;b<f.length;b++)d=f[b],e=this._materials[a][d],"function"==typeof e&&(c[d]=new this._materials[a][d]);return c}},EveMap.Raycaster=function(){THREE.Raycaster.call(this),this.threshold=EveMap.RAY_THRESHOLD},EveMap.Raycaster.prototype=Object.create(THREE.Raycaster.prototype),EveMap.Raycaster.prototype.constructor=EveMap.Raycaster,EveMap.Raycaster.prototype.intersectRegions=function(a){var b,c,d,e=[];for(b=0;b<a.length;b++)c=a[b],d=this.ray.distanceToPoint(c.position),d>c.boundingSphere.radius||e.push({distance:d,object:c});return e.length>0&&e.sort(this.descSort),e},EveMap.Raycaster.prototype.intersectSystems=function(a,b){var c,d=[];if(c=this.intersectRegions(a),0==c.length)return d;var e,f,g,h,i,j,k,l;for(b=b||this.threshold,e=0;e<c.length;e++)for(g=c[e].object,h=g.systems.geometry.vertices,l=new THREE.Matrix4,k=this.ray.clone(),l.getInverse(g.systems.matrixWorld),k.origin.applyMatrix4(l),k.direction.transformDirection(l),f=0;f<h.length;f++)i=h[f],j=k.distanceToPoint(i),j>b||d.push({distance:j,object:i});return d.length>0&&d.sort(this.descSort),d},EveMap.Region=function(a,b){THREE.Object3D.call(this),this.uid=a.uid,this.name=a.name,this.label=null,this.color=null,this.accessable=-1===b.indexOf(this.uid),this.systems=null,this.jumps=null,this.index={systems:[],constellations:[],jumps:[]},a.radius*=1.7,this.position.set(a.x,a.y,a.z),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a.radius),this.test=!1},EveMap.Region.prototype=Object.create(THREE.Object3D.prototype),EveMap.Region.prototype.constructor=EveMap.Region,EveMap.Region.prototype.addSystem=function(a){a.sub(this.position),this.index.systems[a.uid]=a,this.systems.geometry.vertices.push(a);var b=this.systems.material.attributes;this.accessable?(b.securityColor.value.push(a.securityColor),b.actualColor.value.push(a.actualColor)):(b.securityColor.value.push(this.color),b.actualColor.value.push(this.color)),b.regionColor.value.push(this.color),b.radius.value.push(a.radius)},EveMap.Region.prototype.addJump=function(a,b){var c,d,e,f;e=[a,b],f=this.jumps.material.attributes;for(var g=0;2>g;g++)d=e[g],c=d.clone(),this.accessable?(f.actualColor.value.push(d.actualColor),f.securityColor.value.push(d.securityColor)):(f.actualColor.value.push(this.color),f.securityColor.value.push(this.color)),f.regionColor.value.push(d.region.color),this.jumps.geometry.vertices.push(c)},EveMap.Region.prototype.preRender=function(a){this.add(this.jumps),this.add(this.systems),this.label&&(this.label.position=this.position,a.gui.add(this.label))},EveMap.Settings=function(a){this.scale=100,this.rayThreshold=.1,this.toolbarHeight=0,this.projector=new THREE.Projector,this.materials=new EveMap.Materials,this.colors=new EveMap.Colors,this.logger=new EveMap.Logger,this.sources=["regions","systems","jumps"],this.dump=!1,this.autoRotate=!0,this.unAccessibleRegions=[10000004,10000017,10000019],this.scene={minHeight:600,minWidth:1e3},this.colorSettings={generate:["regions","factions"],security:[15728640,14102528,15747072,15753216,14120704,15724288,9432879,61440,61255,4780224,3141615],actual:[15985237,16760132,16729344,8900331,16777215,8900346,16758465,16753920,16761035,16747076,11393254,16776960,16316671],unAccessible:12632256,"default":16777215,actualIndices:[6,7,8,9,10,3796,3797,3798,3799,3800,3801,3802,3803]},this.labels={region:{font:"20px Arial",fillStyle:"rgba(255, 255, 255, 0.95)",uppercase:!0,scaleHeight:20,scaleWidth:10},system:{font:"10px Arial",fillStyle:"rgba(255, 255, 255, 0.95)",uppercase:!1,scaleHeight:2,scaleWidth:1}},this.shaders={list:["stars","lines","labels"],extensions:["vertex|.vsh","fragment|.fsh"],loaded:{}},this.uri={regions:"/api/regions",systems:"/api/systems",jumps:"/api/jumps",constellations:"/api/constellations",factions:"/api/factions",system:"/api/system/",shaders:"/assets/shaders/",dump:"/js/dump.json"},this.camera=function(){var a=new THREE.PerspectiveCamera(30,window.innerWidth/(window.innerHeight-this.toolbarHeight),1,500*EveMap.SCALE);return a.position.set(0,200*this.scale,0),a},this.controls=function(a,b){var c=new THREE.OrbitControls(a,b);return c.minPolarAngle=0,c.maxPolarAngle=Math.PI,c.maxDistance=200*EveMap.SCALE,c.zoomSpeed=.8,c.rotateSpeed=.8,c.enabled=!1,c},this._init(a)},EveMap.Settings.prototype={constructor:EveMap.Settings,_init:function(a){var b,c=this.colors.system;for(this.toolbarHeight=parseInt(window.getComputedStyle(document.getElementById("toolbar"),null).getPropertyValue("height")),b=0;b<this.colorSettings.security.length;b++)c.security.unshift(new THREE.Color(this.colorSettings.security[b]));for(b=0;b<this.colorSettings.actualIndices.length;b++)c.actual[this.colorSettings.actualIndices[b]]=new THREE.Color(this.colorSettings.actual[b]);"function"==typeof a&&a(this),EveMap.SCALE=this.scale,EveMap.RAY_THRESHOLD=this.rayThreshold*EveMap.SCALE},clear:function(){delete this.colorSettings}},EveMap.SystemInterior=function(){THREE.Object3D.call(this)},EveMap.SystemInterior.prototype=Object.create(THREE.Object3D.prototype),EveMap.SystemInterior.prototype.constructor=EveMap.SystemInterior,EveMap.System=function(a,b,c){THREE.Vector3.call(this,b.x,b.y,b.z),this.label=null,this.uid=b.uid,this.name=b.name,this.region=a,this.constellationID=b.constellationID,this.security=b.security,this.radius=b.radius,this.luminosity=b.luminosity,this.sunTypeID=b.sunTypeID,this.active=!1,this.actualColor=c.getSystemActualColor(this.sunTypeID),this.securityColor=c.getSystemSecurityColor(this.security)},EveMap.System.prototype=Object.create(THREE.Vector3.prototype),EveMap.System.prototype.constructor=EveMap.System,EveMap.WGL=function(a,b){this.evemap=a,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),this.renderer.domElement.id="wgl-renderer",this.loaded=!1,b.appendChild(this.renderer.domElement),this.evemap.addEvent(EveMap.EVENT_MAP_DATA_LOADED,this._dataLoaded.bind(this))},EveMap.WGL.prototype={constructor:EveMap.WGL,_dataLoaded:function(){this.loadRegions(),this.loadSystems(),this.loadJumps()},add:function(a){this.scene.add(a)},resize:function(a,b){this.renderer.setSize(a,b)},render:function(){this.renderer.render(this.scene,this.evemap.camera)},loadRegions:function(){var a,b,c,d;for(c=this.evemap.raw.regions,d=this.evemap.settings.unAccessibleRegions,a=0;a<c.length;a++)b=new EveMap.Region(c[a],d),b.color=b.accessable?this.evemap.colors.getGenericColor("regions",a):this.evemap.colors.unAccessible,b.label=EveMap.Label.createCSS3DLabel(b,{className:"rl"}),b.systems=new THREE.ParticleSystem(new THREE.Geometry,this.evemap.settings.materials.getMaterial("stars")),b.jumps=new THREE.Line(new THREE.Geometry,this.evemap.settings.materials.getMaterial("lines"),THREE.LinePieces),this.evemap.index.regions[b.uid]=b,this.evemap.regions.push(b)},loadConstellations:function(){},loadSystems:function(){var a,b,c,d;for(a=0;a<this.evemap.raw.systems.length;a++)d=this.evemap.raw.systems[a],b=this.evemap.index.regions[d.regionID],c=new EveMap.System(b,d,this.evemap.settings.colors),this.evemap.index.systems[c.uid]=c,b.addSystem(c)},loadJumps:function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.evemap.regionalJumps=new THREE.Line(new THREE.Geometry,this.evemap.settings.materials.getMaterial("lines"),THREE.LinePieces),i=this.evemap.regionalJumps.material.attributes,l=this.evemap.regionalJumps.geometry.vertices,a=0;a<this.evemap.raw.jumps.length;a++){if(c=this.evemap.raw.jumps[a],f=this.evemap.index.regions[c.fromRegionID],g=this.evemap.index.regions[c.toRegionID],d=this.evemap.index.systems[c.fromSolarSystemID],e=this.evemap.index.systems[c.toSolarSystemID],!d||!e)throw new Error("Could not process jumps.");if(f.uid===g.uid)f.addJump(d,e);else for(h=[d,e],b=0;2>b;b++)j=h[b],k=j.clone(),j.region.accessable?(i.actualColor.value.push(j.actualColor),i.securityColor.value.push(j.securityColor)):(i.actualColor.value.push(j.region.color),i.securityColor.value.push(j.region.color)),i.regionColor.value.push(j.region.color),l.push(k.add(j.region.position))}this.add(this.evemap.regionalJumps);var m;for(a=0;a<this.evemap.raw.regions.length;a++)m=this.evemap.index.regions[this.evemap.raw.regions[a].uid],m.preRender(this.evemap),this.add(m);this.loaded=!0}};